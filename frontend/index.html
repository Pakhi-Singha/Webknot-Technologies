<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Campus Reports</title>
  <style>
    :root { font-family: system-ui, sans-serif; color-scheme: light dark; }
    body { margin: 24px; }
    h1 { margin: 0 0 12px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
    input, select, button { padding: 8px 10px; border-radius: 8px; border: 1px solid #8884; }
    button { cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #8884; text-align: left; }
    .card { padding: 16px; border: 1px solid #8884; border-radius: 12px; box-shadow: 0 1px 8px #0001; margin: 12px 0; }
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(320px,1fr)); }
    .muted { opacity: .7; font-size: 12px; }
  </style>
</head>
<body>
  <h1>Campus Event Reports</h1>
  <div class="row">
    <label>College ID <input id="collegeId" type="number" value="1"></label>
    <label>Event ID <input id="eventId" type="number" value="1"></label>
    <label>Type
      <select id="eventType">
        <option value="">(all)</option>
        <option>Workshop</option>
        <option>Seminar</option>
        <option>Fest</option>
      </select>
    </label>
    <label>Top N <input id="limit" type="number" value="3" min="1"></label>
    <button id="run">Run Reports</button>
  </div>

  <div class="grid">
    <div class="card"><h3>Event Popularity</h3><div id="pop"></div></div>
    <div class="card"><h3>Event Popularity (by Type)</h3><div id="popType"></div></div>
    <div class="card"><h3>Attendance %</h3><div id="att"></div></div>
    <div class="card"><h3>Average Feedback</h3><div id="avg"></div></div>
    <div class="card"><h3>Top Active Students</h3><div id="top"></div></div>
  </div>

  <p class="muted">API: http://127.0.0.1:8000 â€” open <a href="http://127.0.0.1:8000/docs">/docs</a> for details.</p>

  <script>
    const API = "http://127.0.0.1:8000";
    const el = id => document.getElementById(id);
    const toTable = (rows) => {
      if (!rows || !rows.length) return "<p class='muted'>No data</p>";
      const cols = Object.keys(rows[0]);
      return `<table><thead><tr>${cols.map(c=>`<th>${c}</th>`).join("")}</tr></thead>
              <tbody>${rows.map(r=>`<tr>${cols.map(c=>`<td>${r[c]??""}</td>`).join("")}</tr>`).join("")}</tbody></table>`;
    };
    async function getJSON(url){ const r = await fetch(url); if(!r.ok) throw new Error(await r.text()); return r.json(); }
    async function run(){
      const collegeId = +el("collegeId").value;
      const eventId = +el("eventId").value;
      const type = el("eventType").value;
      const limit = +el("limit").value;

      Promise.allSettled([
        getJSON(`${API}/reports/event-popularity?college_id=${collegeId}`),
        getJSON(`${API}/reports/event-popularity?college_id=${collegeId}${type?`&type=${encodeURIComponent(type)}`:""}`),
        getJSON(`${API}/reports/attendance?event_id=${eventId}`),
        getJSON(`${API}/reports/average-feedback?event_id=${eventId}`),
        getJSON(`${API}/reports/top-active-students?college_id=${collegeId}&limit=${limit}`)
      ]).then(([pop, popType, att, avg, top])=>{
        el("pop").innerHTML     = pop.status==="fulfilled"     ? toTable(pop.value) : `<pre>${pop.reason}</pre>`;
        el("popType").innerHTML = popType.status==="fulfilled" ? toTable(popType.value) : `<pre>${popType.reason}</pre>`;
        el("att").innerHTML     = att.status==="fulfilled"     ? `<pre>${JSON.stringify(att.value,null,2)}</pre>` : `<pre>${att.reason}</pre>`;
        el("avg").innerHTML     = avg.status==="fulfilled"     ? `<pre>${JSON.stringify(avg.value,null,2)}</pre>` : `<pre>${avg.reason}</pre>`;
        el("top").innerHTML     = top.status==="fulfilled"     ? toTable(top.value) : `<pre>${top.reason}</pre>`;
      });
    }
    el("run").addEventListener("click", run);
  </script>
</body>
</html>
